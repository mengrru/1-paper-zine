(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{7987:function(e,t,n){Promise.resolve().then(n.bind(n,113))},113:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return b}});var a=n(7437),o=n(2265);let r=(0,o.createContext)({}),i={type:"8",LayoutConfig:[["FRONT COVER","BACK COVER","7","6"],["2","3","4","5"]],WIDTH:297,HEIGHT:210,BASE:4,Padding:1.5},l={14:{type:"14",LayoutConfig:[["BACK COVER","FRONT COVER","1","2"],["6","5","4","3"],["7","8","9","10"],["","","12","11"]],WIDTH:210,HEIGHT:297,BASE:4,Padding:1.5},8:i},s=e=>{if(!e)return Promise.resolve("");let t=new FileReader;return t.readAsDataURL(e),new Promise((e,n)=>{t.onloadend=()=>{e(t.result)}})},d=e=>{if(!e)return Promise.resolve("");let t=new FileReader;return t.readAsText(e),new Promise((e,n)=>{t.onloadend=()=>{e(t.result)}})},c=(e,t,n,a)=>{let o=n/a>e/t?n/e:a/t;return n/a>t/e?t/(n/o):e/(a/o)},u=(e,t)=>{let n=new Blob([t],{type:"text/plain"}),a=document.createElement("a");a.download=e,a.href=URL.createObjectURL(n),a.dataset.downloadurl=["text/plain",a.download,a.href].join(":"),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),setTimeout(function(){URL.revokeObjectURL(a.href)},1500)},g=e=>{let t=document.createElement("input");t.type="file",t.onchange=e,t.click()},p=()=>Date.now().toString(),m=e=>{let t=[];for(let n=0;n<e.length;n++)"-"===e[n]?++n<e.length&&t.push(e[n].toUpperCase()):t.push(e[n]);return t.join("")},x=e=>{let t=[];for(let n=0;n<e.length;n++)97>e[n].charCodeAt(0)&&t.push("-"),t.push(e[n].toLowerCase());return t.join("")},h=()=>{let[e,t]=(0,o.useState)(i),[n,a]=(0,o.useState)([]),[r,l]=(0,o.useState)({}),[s,d]=(0,o.useState)("");return{pageParam:e,gridData:n,itemData:r,selectedItem:s,rowNum:e.LayoutConfig.length,colNum:e.LayoutConfig[0].length,setPadding(e){t(t=>(t.Padding=e,{...t}))},setConfig(e){t(()=>({...e}))},selectItem(e){d(e)},addItem(){let e=p();return l(t=>(t[e]={style:""},{...t})),e},removeItem(e){l(t=>(delete t[e],{...t}))},setItemStyle(e,t){l(n=>{let a=n[e];return a?(a.style=t,{...n}):n})},setGridImageURL(e,t){a(n=>(n[e]?n[e].imageURL=t:n[e]={imageURL:t,imageRotateAngle:0},[...n]))},setGridImageRotateAngle(e,t){a(n=>(n[e]?n[e].imageRotateAngle=t:n[e]={imageURL:"",imageRotateAngle:t},[...n]))},emptyGridData(){a([])},import(e){let n=JSON.parse(e);n.gridData&&n.pageParam&&(t(n.pageParam),a(n.gridData),l(n.itemData))},export:()=>JSON.stringify({gridData:n,pageParam:e,itemData:r,version:1})}},v=e=>{let{id:t}=e,{previewerModel:{selectItem:n,setItemStyle:i,selectedItem:l,itemData:s},mouseCoord:{x:d,y:c}}=(0,o.useContext)(r),[u,g]=(0,o.useState)(!1),[p,m]=(0,o.useState)({x:0,y:0}),x=(0,o.useMemo)(()=>f(s[t].style),[s[t].style]),[h,v]=(0,o.useState)({}),y=()=>{g(!1),i(t,C({...x,...h}))};return(0,a.jsx)("div",{className:"item",style:{...x,...h,outline:l===t?"1px solid #000":"none"},onMouseDown:e=>{g(!0);var a=e.target.getBoundingClientRect();m({x:e.pageX-a.left,y:e.pageY-a.top}),n(t)},onMouseUp:y,onMouseLeave:y,onMouseMove:e=>{u&&v({top:"".concat(c-p.y,"px"),left:"".concat(d-p.x,"px")})},children:x.content})},f=e=>e.replace(/\n/g,"").split(";").map(e=>e.split(":")).reduce((e,t)=>(e[m(t[0])]=t[1],e),{}),C=e=>Object.keys(e).reduce((t,n)=>{let a=e[n];return void 0===a?t:"".concat(t).concat(x(n),":").concat(a,";\n")},""),y=e=>{var t,n;let{isFlip:i,text:l,index:d}=e,{previewerModel:{rowNum:u,colNum:p,pageParam:{WIDTH:m,HEIGHT:x,Padding:h}},previewerModel:v}=(0,o.useContext)(r),f=(0,o.useMemo)(()=>v.gridData[d]?v.gridData[d].imageURL:"",[null===(t=v.gridData[d])||void 0===t?void 0:t.imageURL]),C=(0,o.useMemo)(()=>v.gridData[d]?v.gridData[d].imageRotateAngle:0,[null===(n=v.gridData[d])||void 0===n?void 0:n.imageRotateAngle]),y=(0,o.useRef)(null);return(0,o.useEffect)(()=>{if(!y.current)return;let e=y.current,t=c((m-h*p)/p,(x-h*u)/u,e.width,e.height);e.style.transform="rotate(".concat(C,"deg)").concat(C%180!=0?"scale(".concat(t,")"):""),e.style.transformOrigin="50% 50%"},[C]),(0,a.jsx)("div",{className:"grid ".concat(""!==f&&"transparentBg"),style:i?{transform:i?"rotate(180deg)":""}:{},onClick:()=>{g(e=>{var t;s(null===(t=e.target.files)||void 0===t?void 0:t[0]).then(e=>{v.setGridImageURL(d,e)})})},children:""===f?(0,a.jsx)("span",{children:l}):(0,a.jsx)("img",{ref:y,src:f,onContextMenu:e=>{e.preventDefault(),v.setGridImageRotateAngle(d,C-90)}})})};function j(){let{previewerModel:{colNum:e,itemData:t,pageParam:{WIDTH:n,HEIGHT:i,BASE:l,Padding:s,LayoutConfig:d}},mouseCoord:c}=(0,o.useContext)(r);return(0,a.jsxs)("div",{className:"previewer",onMouseMove:e=>{var t=e.currentTarget.getBoundingClientRect();c.setX(e.pageX-t.left),c.setY(e.pageY-t.top)},style:{display:"grid",gridTemplateColumns:"repeat(".concat(d[0].length,", 1fr)"),gridRowGap:"".concat(l*s*2,"px"),gridColumnGap:"".concat(l*s*2,"px"),padding:"".concat(l*s,"px"),width:"".concat(l*n,"px"),height:"".concat(l*i,"px"),boxSizing:"border-box"},children:[d.map((t,n)=>t.map((t,o)=>(0,a.jsx)(y,{index:n*e+o,text:t,isFlip:n%2==1},n*e+o))),Object.keys(t).map(e=>(0,a.jsx)(v,{id:e},e))]})}let R=()=>{var e;let{previewerModel:{addItem:t,removeItem:n,selectItem:i,itemData:s,selectedItem:c,setConfig:p,pageParam:m,setPadding:x,setItemStyle:h},previewerModel:v}=(0,o.useContext)(r),[f,C]=(0,o.useState)(!1);return(0,a.jsxs)("div",{className:"panel",style:{opacity:f?1:0},onMouseOver:()=>C(!0),onMouseLeave:()=>C(!1),children:[(0,a.jsxs)("button",{onClick:()=>{"14"===m.type?p(l[8]):p(l[14])},children:["Switch to ","14"===m.type?"8":"14"]}),(0,a.jsxs)("div",{className:"panel-row",children:[(0,a.jsx)("button",{onClick:()=>{g(e=>{var t;d(null===(t=e.target.files)||void 0===t?void 0:t[0]).then(e=>{v.import(e)})})},children:"Import"}),(0,a.jsx)("button",{onClick:()=>{u("1-paper-zine-".concat(Date.now(),".metadata.json"),v.export())},children:"Export"})]}),(0,a.jsxs)("div",{className:"panel-row",children:[(0,a.jsx)("button",{onClick:()=>{i(t())},children:"+ Item"}),(0,a.jsx)("button",{onClick:()=>{n(c)},children:"- Item"})]}),(0,a.jsxs)("div",{className:"panel-row",children:[(0,a.jsx)("button",{onClick:()=>x(m.Padding+.5),children:"+ Padding"}),(0,a.jsx)("button",{onClick:()=>m.Padding>0&&x(m.Padding-.5),children:"- Padding"})]}),(0,a.jsx)("button",{onClick:()=>i(""),children:"Clear focus"}),(0,a.jsx)("textarea",{onChange:e=>{h(c,e.target.value)},value:""===c?"":null===(e=s[c])||void 0===e?void 0:e.style})]})},w=()=>{let[e,t]=(0,o.useState)(0),[n,a]=(0,o.useState)(0);return{x:e,y:n,setX:t,setY:a}};function b(){let e=h(),t=w();return(0,a.jsxs)(r.Provider,{value:{previewerModel:e,mouseCoord:t},children:[(0,a.jsx)(R,{}),(0,a.jsx)(j,{})]})}}},function(e){e.O(0,[971,23,744],function(){return e(e.s=7987)}),_N_E=e.O()}]);